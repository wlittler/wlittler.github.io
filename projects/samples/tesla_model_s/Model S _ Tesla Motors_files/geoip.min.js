var geoip2=function(){"use strict";function e(e,t,r,o){this.successCallback=e,this.errorCallback=t,r&&r.hasOwnProperty("geolocation")?this.geolocation=r.geolocation:this.geolocation=navigator.geolocation,this.type=o}function t(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}function r(e){for(var t=window.location.search.substring(1),r=t.split("&"),o=0;o<r.length;o++){var n=r[o].split("=");if(n[0]===e)return n[1]}return!1}var o={};return e.prototype.returnSuccess=function(e){this.successCallback&&"function"==typeof this.successCallback&&this.successCallback(e)},e.prototype.returnError=function(e){this.errorCallback&&"function"==typeof this.errorCallback&&(e||(e={error:"Unknown error"}))},e.prototype.getGeoIPResult=function(){var e,o,n=this;if(o=-1===window.location.hostname.indexOf("tesla.cn")?"https://location.teslamotors.com/geoip/v1.0.3/"+this.type+"/":"https://location.tesla.cn/geoip/v1.0.3/"+this.type+"/",r("ip")&&(o=o+"?ip="+r("ip")),!this.alreadyRan){this.alreadyRan=1;var e=t("get",o);e&&(e.onload=function(){if("undefined"==typeof e.status||200===e.status)n.returnSuccess(JSON.parse(e.responseText));else{var t,r=e.hasOwnProperty("contentType")?e.contentType:e.getResponseHeader("Content-Type");if(/json/.test(r)&&e.responseText.length)try{t=n.objectFromJSON(e.responseText)}catch(o){t={code:"HTTP_ERROR",error:"The server returned a "+e.status+" status with an invalid JSON body."}}else t=e.responseText.length?{code:"HTTP_ERROR",error:"The server returned a "+e.status+" status with the following body: "+e.responseText}:{code:"HTTP_ERROR",error:"The server returned a "+e.status+" status but either the server did not return a body or this browser is a version of Internet Explorer that hides error bodies."};n.returnError(t)}},e.ontimeout=function(){n.returnError({code:"HTTP_TIMEOUT",error:"The request to the Tesla Geo IP web service timed out."})},e.onerror=function(){n.returnError({code:"HTTP_ERROR",error:"There was a network error receiving the response from the Tesla Geo IP web service."})},e.send(e.responseText))}},o.country=function(t,r,o){var n=new e(t,r,o,"country");n.getGeoIPResult()},o.city=function(t,r,o){var n=new e(t,r,o,"city");n.getGeoIPResult()},o.connection=function(t,r,o){var n=new e(t,r,o,"connection");n.getGeoIPResult()},o}();